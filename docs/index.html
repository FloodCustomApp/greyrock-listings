<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GreyRock CRE - Commercial Properties</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<style>
  :root {
    --bg-primary: #0f1114;
    --bg-secondary: #1a1d23;
    --bg-card: #22262e;
    --bg-card-hover: #2a2f38;
    --border: #2e333d;
    --text-primary: #f0f0f0;
    --text-secondary: #9ba3b0;
    --text-muted: #6b7280;
    --accent: #c8a97e;
    --accent-hover: #d4b98e;
    --accent-dim: rgba(200,169,126,0.15);
    --green: #34d399;
    --radius-lg: 12px;
    --transition: 0.25s cubic-bezier(0.4,0,0.2,1);
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Wix Madefor Text', 'Helvetica Neue', Helvetica, Arial, sans-serif;
    background: var(--bg-primary);
    color: var(--text-primary);
    line-height: 1.6;
    overflow: hidden; /* Important for single-section layout */
  }

  .container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 100px 24px 24px; /* Header Overhang */
    height: 100vh;
    display: flex;
    flex-direction: column;
  }

  /* ─── INTEGRATED HEADER ─── */
  .app-header { margin-bottom: 40px; }
  .app-header-eyebrow { display: inline-flex; align-items: center; gap: 10px; font-size: 0.85rem; font-weight: 600; letter-spacing: 0.1em; text-transform: uppercase; margin-bottom: 12px; }
  .app-header-eyebrow svg { color: var(--accent); width: 18px; height: 18px; }
  .app-header-title { font-family: 'Times New Roman', Times, serif; font-size: clamp(2.5rem, 5vw, 4.2rem); font-weight: 400; line-height: 1.1; margin-bottom: 20px; }
  .app-header-description { color: var(--text-secondary); font-size: 1rem; max-width: 1200px; }

  /* ─── SEARCH & FILTERS ─── */
  .search-bar { display: flex; gap: 12px; margin-bottom: 16px; }
  .search-input { flex: 1; background: var(--bg-secondary); border: 1px solid var(--border); color: #fff; padding: 12px 16px 12px 40px; border-radius: 8px; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 24 24' fill='none' stroke='%236b7280' stroke-width='2'%3E%3Ccircle cx='11' cy='11' r='8'/%3E%3Cpath d='m21 21-4.35-4.35'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: 12px center; outline: none; }
  .filter-bar { display: flex; flex-wrap: wrap; gap: 12px; padding: 16px; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 8px; margin-bottom: 24px; align-items: flex-end; }
  .filter-group { display: flex; flex-direction: column; gap: 6px; flex: 1; min-width: 140px; }
  .filter-group label { font-size: 0.65rem; text-transform: uppercase; color: var(--text-muted); font-weight: 700; letter-spacing: 0.05em; }
  .filter-group select { background: var(--bg-primary); border: 1px solid var(--border); color: var(--text-primary); padding: 8px; border-radius: 4px; outline: none; }
  .btn-filter { padding: 9px 20px; background: var(--accent); color: var(--bg-primary); border: none; border-radius: 6px; font-weight: 600; cursor: pointer; }

  /* ─── MAP & CARDS LAYOUT ─── */
  .listings-layout { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; flex: 1; min-height: 0; margin-bottom: 24px; }
  .map-container { height: 100%; border-radius: var(--radius-lg); border: 1px solid var(--border); overflow: hidden; }
  #map { height: 100%; width: 100%; }
  .cards-container { overflow-y: auto; padding-right: 8px; overscroll-behavior: contain; }

  /* ─── PROPERTY CARDS ─── */
  .property-card { display: grid; grid-template-columns: 220px 1fr; background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius-lg); overflow: hidden; cursor: pointer; margin-bottom: 16px; transition: all var(--transition); }
  .property-card:hover { border-color: var(--accent); background: var(--bg-card-hover); }
  .card-image { width: 100%; height: 100%; object-fit: cover; background: var(--bg-secondary); }
  .card-body { padding: 20px; display: flex; flex-direction: column; justify-content: space-between; }
  .card-title { font-family: 'Times New Roman', Times, serif; font-size: 1.25rem; font-weight: 400; margin-bottom: 4px; }
  .card-price { font-size: 1.3rem; font-weight: 700; color: var(--accent); }

  /* ─── MODAL ─── */
  .detail-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 2000; backdrop-filter: blur(4px); }
  .detail-modal { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 16px; z-index: 2001; width: 90%; max-width: 800px; max-height: 85vh; overflow-y: auto; display: none; }
  .detail-modal.open, .detail-overlay.open { display: block; }
  .modal-close { position: absolute; top: 15px; right: 15px; background: rgba(0,0,0,0.5); color: #fff; border: none; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; z-index: 10; }

  @media (max-width: 1024px) { .listings-layout { grid-template-columns: 1fr; } .map-container { height: 300px; } .container { height: auto; overflow: visible; } body { overflow: auto; } }
</style>
</head>
<body>

<div class="container">
  <div class="app-header">
    <div class="app-header-eyebrow">
      <svg viewBox="0 0 24 24" fill="currentColor"><circle cx="4" cy="4" r="2.5"/><circle cx="12" cy="4" r="2.5"/><circle cx="20" cy="4" r="2.5"/><circle cx="4" cy="12" r="2.5"/><circle cx="12" cy="12" r="2.5"/><circle cx="20" cy="12" r="2.5"/><circle cx="4" cy="20" r="2.5"/><circle cx="12" cy="20" r="2.5"/><circle cx="20" cy="20" r="2.5"/></svg>
      Serving the Charlotte Metro Area
    </div>
    <h1 class="app-header-title">Commercial Properties for Lease</h1>
    <p class="app-header-description"><strong>GreyRock Commercial Real Estate</strong> provides full-service commercial property management, leasing, and investment support throughout the greater Charlotte metro area. We help owners protect assets and maximize performance.</p>
  </div>

  <div class="search-bar">
    <input type="text" class="search-input" id="searchInput" placeholder="Search by address, name, or description...">
  </div>

  <div class="filter-bar">
    <div class="filter-group"><label>Type</label><select id="filterType"><option value="">All Types</option></select></div>
    <div class="filter-group"><label>Min Price</label><select id="filterMinPrice"><option value="0">No Min</option><option value="1000">$1,000</option><option value="2000">$2,000</option></select></div>
    <div class="filter-group"><label>Max Price</label><select id="filterMaxPrice"><option value="999999">No Max</option><option value="3000">$3,000</option><option value="5000">$5,000</option></select></div>
    <button class="btn-filter" id="applyFilters">Search</button>
  </div>

  <div class="listings-layout">
    <div class="map-container"><div id="map"></div></div>
    <div class="cards-container" id="cardsContainer"></div>
  </div>
</div>

<div class="detail-overlay" id="detailOverlay"></div>
<div class="detail-modal" id="detailModal">
    <button class="modal-close" onclick="closeModal()">×</button>
    <div id="modalContent"></div>
</div>

<script>
const DATA_URL = 'https://jaredflood.github.io/greyrock-listings/listings.json';
let LISTINGS = [], map, markers = {};

async function loadData() {
    const res = await fetch(DATA_URL + '?v=' + Date.now());
    const data = await res.json();
    LISTINGS = data.listings;
    initMap();
    render(LISTINGS);
    populateFilters();
}

function initMap() {
    map = L.map('map').setView([35.32, -80.85], 10);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(map);
}

function render(data) {
    const container = document.getElementById('cardsContainer');
    container.innerHTML = data.map(l => `
        <div class="property-card" onclick="openModal('${l.id}')">
            <img class="card-image" src="${l.imageUrl || ''}">
            <div class="card-body">
                <div>
                    <div class="card-title">${l.title}</div>
                    <div style="color:var(--text-secondary); font-size:0.85rem;">${l.address}</div>
                </div>
                <div class="card-price">$${l.rent?.toLocaleString()}/mo</div>
            </div>
        </div>
    `).join('');

    Object.values(markers).forEach(m => map.removeLayer(m));
    data.forEach(l => {
        if(l.lat) markers[l.id] = L.marker([l.lat, l.lng]).addTo(map).bindPopup(l.title);
    });
}

function populateFilters() {
    const types = [...new Set(LISTINGS.map(l => l.type))];
    const sel = document.getElementById('filterType');
    types.forEach(t => { if(t) sel.innerHTML += `<option value="${t}">${t}</option>`; });
}

document.getElementById('applyFilters').onclick = () => {
    const type = document.getElementById('filterType').value;
    const min = parseInt(document.getElementById('filterMinPrice').value);
    const max = parseInt(document.getElementById('filterMaxPrice').value);
    const search = document.getElementById('searchInput').value.toLowerCase();

    const filtered = LISTINGS.filter(l => {
        if (type && l.type !== type) return false;
        if (l.rent < min || l.rent > max) return false;
        if (search && !l.title.toLowerCase().includes(search)) return false;
        return true;
    });
    render(filtered);
};

function openModal(id) {
    const l = LISTINGS.find(x => x.id === id);
    document.getElementById('modalContent').innerHTML = `
        <img src="${l.imageUrl}" style="width:100%; height:300px; object-fit:cover;">
        <div style="padding:30px;">
            <h2 style="font-family:Times; font-size:2rem; margin-bottom:10px;">${l.title}</h2>
            <p style="color:var(--text-secondary); margin-bottom:20px;">${l.description}</p>
            <a href="https://www.greyrockcre.com/contact" target="_blank" style="display:block; text-align:center; padding:15px; background:var(--accent); color:var(--bg-primary); text-decoration:none; font-weight:bold; border-radius:8px;">Contact Us</a>
        </div>
    `;
    document.getElementById('detailModal').classList.add('open');
    document.getElementById('detailOverlay').classList.add('open');
}

function closeModal() {
    document.getElementById('detailModal').classList.remove('open');
    document.getElementById('detailOverlay').classList.remove('open');
}

loadData();
</script>
</body>
</html>
